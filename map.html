<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Global Weather Forecast</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  #map { height: 600px; width: 100%; }
  #controls { padding: 5px; }
</style>
</head>
<body>

<h2>Global Weather Forecast (Ventusky-style)</h2>
<div id="map"></div>
<div id="controls">
  <button onclick="prevStep()">⏮ Previous</button>
  <button onclick="nextStep()">Next ⏭</button>
  <span id="timeLabel">Time: </span>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/chroma-js@2.1.0/chroma.min.js"></script>

<script>
// --- Initialize Map ---
const map = L.map('map').setView([0, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// --- Dummy Forecast Data (global grid) ---
const forecastData = [];
const startDate = new Date("2026-01-24T12:00:00Z"); // START AT 12 PM UTC
const steps = 56; // 7 days, 3-hourly

// Generate grid: lat -90 to 90, lon -180 to 180, step 10 degrees
for(let i=0;i<steps;i++){
  const time = new Date(startDate.getTime() + i*3*3600*1000);
  let stepData = [];
  for(let lat=-90; lat<=90; lat+=10){
    for(let lon=-180; lon<=180; lon+=10){
      stepData.push({
        lat: lat,
        lon: lon,
        temp: Math.random()*60-20,    // -20°C to 40°C
        precip3h: Math.random()*10,   // 0-10 mm
        wind10: Math.random()*20,     // 0-20 m/s
        gust1h: Math.random()*30,     // 0-30 m/s
        time: time
      });
    }
  }
  forecastData.push(stepData);
}

// --- Current Step ---
let currentStep = 0;
let layersGroup = L.layerGroup().addTo(map);

// --- Draw Forecast ---
function drawForecast(stepIndex){
  layersGroup.clearLayers();
  const data = forecastData[stepIndex];
  data.forEach(d=>{
    // Temperature color
    const tempColor = chroma.scale(['blue','green','yellow','red']).domain([-30,50])(d.temp).hex();
    L.circleMarker([d.lat,d.lon],{
      radius: 5,
      color: tempColor,
      fillColor: tempColor,
      fillOpacity: 0.6
    }).addTo(layersGroup);

    // Precipitation overlay
    if(d.precip3h>0){
      const precipColor = chroma.scale(['#00f','#0044ff']).domain([0,10])(d.precip3h).hex();
      L.circleMarker([d.lat,d.lon],{
        radius: 3,
        color: precipColor,
        fillColor: precipColor,
        fillOpacity: 0.5
      }).addTo(layersGroup);
    }

    // Wind 10m arrows (dummy direction)
    const arrowLength = d.wind10;
    const angle = Math.random()*360; 
    const rad = angle*Math.PI/180;
    const dx = arrowLength*Math.cos(rad);
    const dy = arrowLength*Math.sin(rad);
    L.polyline([
      [d.lat,d.lon],
      [d.lat+dy*0.05,d.lon+dx*0.05]
    ], {color:'black', weight:1}).addTo(layersGroup);

    // Wind gust 1h
    if(d.gust1h>15){
      L.circleMarker([d.lat,d.lon],{
        radius:2,
        color:'red',
        fillColor:'red',
        fillOpacity:0.7
      }).addTo(layersGroup);
    }
  });
  document.getElementById('timeLabel').innerText = "Time: "+data[0].time.toUTCString();
}

// --- Controls ---
function nextStep(){
  currentStep = (currentStep+1)%forecastData.length;
  drawForecast(currentStep);
}
function prevStep(){
  currentStep = (currentStep-1+forecastData.length)%forecastData.length;
  drawForecast(currentStep);
}

// --- Auto-play ---
setInterval(nextStep, 1000);

// --- Initial Draw ---
drawForecast(currentStep);
</script>

</body>
</html>
